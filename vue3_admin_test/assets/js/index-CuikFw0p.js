import{aI as Mt,N as Ie,aF as Oe,h as _,M as Ve,c as H,o as U,a2 as J,b as F,aG as Q,u as G,a as P,F as xt,r as re,w as q,e as ae,R as Ge,g as Bt,t as se,n as At,Y as ze,d as Et,aH as Ft,B as $t,aJ as It,a6 as Ot}from"./index-D1QEh7pE.js";import{V,a as A,D as ee,P as Le,t as de,g as Vt,M as Gt,d as zt,b as Rt,S as z,c as W,F as X,C as ye,e as O,f as Zt,h as R,i as qt,L as jt,T as Re,j as K,Z as Nt,k as Ut,l as Wt,m as Xt,n as Ht,K as Kt,O as Ze,o as Yt,p as Jt,W as Qt,X as eo,I as qe,q as to,r as oo,s as no,u as ro}from"./Draw-CvWszftC.js";import{m as w}from"./mittBus-rOgeEvW-.js";import{g as ve}from"./gis-lQTIXZlx.js";import ao from"./DemoPopupDetailDialog-CW4KcsIL.js";import{_ as me}from"./plugin-vueexport-helper-DlAUqK2U.js";import so from"./index-BiyzN-xb.js";const je={commonMenu:{commonMenuMethod1:"拷贝当前经纬度",commonMenuMethod3:"切换天地图token"},commonDynamicMenu:{commonDynamicMenuMethod1:"清除所有要素",commonDynamicMenuMethod2:"显示当前要素信息",commonDynamicMenuMethod3:"仅取消绘制状态",commonDynamicMenuMethod4:"展示分析结果",commonDynamicMenuMethod5:"删除所有绘制内容"},singleMenu:{singleMenuMethod1:"刷新地图",singleMenuMethod2:"清除POI点"}},{commonMenu:xe}=je;let Ne=[];for(let e in xe)Ne.push(xe[e]);const E={menuMethodBtn:je,commonMenuMethodsArr:Ne,setMenuMethods(e,t,n,o,s){let i=te(o);const{commonMenu:l,commonDynamicMenu:u,singleMenu:c}=this.menuMethodBtn;switch(t){case l.commonMenuMethod0:Eo(e,n,o);break;case l.commonMenuMethod01:Ao(e,o);break;case"清空自定义标注点":Z(e,v=>v.get("tempType")==="myPointByMenu");break;case l.commonMenuMethod02:st(e,o);break;case"清空自定义闪烁点":document.querySelectorAll(".flicker_point").forEach(v=>{v.classList.remove("flicker_point")});break;case l.commonMenuMethod1:Mt(`[${i}]`,()=>{Ie.success(`[${i}] 拷贝成功`)});break;case l.commonMenuMethod2:et(e,n);break;case l.commonMenuMethod3:w.emit("showSetTokenDialog");break;case u.commonDynamicMenuMethod1:Ce(e);break;case u.commonDynamicMenuMethod2:w.emit("singleFeaturesClick",{feature:n,pixelPoint:o});break;case u.commonDynamicMenuMethod3:Te(e);break;case u.commonDynamicMenuMethod4:let C=n.get("pointData");w.emit("analysisPointData",C);break;case u.commonDynamicMenuMethod5:Z(e,v=>v.get("drawType"));break;case c.singleMenuMethod1:w.emit("reflashMap");break;case c.singleMenuMethod2:nt(e,"POIMarker");break}},setMentBtnExtendByPage(e){const{singleMenu:t}=this.menuMethodBtn;switch(e){case"gis":le(t.singleMenuMethod1),le(t.singleMenuMethod2);break}}};let lo=0,he="6b94eac741fe8a50f283b9b11d9d60d2";const Be=ve(),I=(e,t=!0)=>(Be.mapToken!==""&&(he=Be.mapToken),t?e+he:e),Ue=(e,t={},n={})=>new Qt({source:new eo({url:e,crossOrigin:"anonymous",...t}),type:"baseLayer",url:e,...n}),We=e=>Ue(e,{wrapX:!1},{layerType:"baseMapLayer"}),ke=e=>Ue(e,{},{layerType:"baseMapTxt"}),pe={getBaseMapLayer(e){switch(e){case"empty":return I("/xxx/{z}/{y}/{x}.png",!1);case"t0vec":return I("http://t0.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t3img":return I("http://t3.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=");case"t4ter":return I("http://t4.tianditu.com/DataServer?T=ter_w&x={x}&y={y}&l={z}&tk=");case"t07vec":return I("http://t{0-7}.tianditu.com/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=");case"t07img":return I("http://t{0-7}.tianditu.com/DataServer?T=img_w&x={x}&y={y}&l={z}&tk=")}},getBaseMapTxt(e){switch(e){case"empty":return I("",!1);case"t0cva":return I("http://t0.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t4cva":return I("http://t4.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=");case"t07cia":return I("http://t{0-7}.tianditu.com/DataServer?T=cia_w&x={x}&y={y}&l={z}&tk=");case"t07cva":return I("http://t{0-7}.tianditu.com/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=")}}},we=15,Ae={layers:[We(pe.getBaseMapLayer("t3img")),ke(pe.getBaseMapTxt("t07cia"))],view:new Rt({center:R([121.63,29.88]),zoom:16,maxZoom:17,minZoom:13,constrainResolution:!0,smoothResolutionConstraint:!1})},N=(e,t)=>{e&&(e instanceof Array?(e.length!==0&&le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(n=>n!==t))):e instanceof O?e.get("tempType")||le(t):(le(t),e.length===0&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(n=>n!==t)))),!e&&E.commonMenuMethodsArr.includes(t)&&(E.commonMenuMethodsArr=E.commonMenuMethodsArr.filter(n=>n!==t))},Xe=new z({image:new ye({radius:5,fill:new X({color:"#f49d41"}),stroke:new W({color:"#836365",width:1})})}),He=(e,t)=>new z({image:new qe({src:t,anchor:[.8,80],anchorOrigin:"top-right",anchorXUnits:"fraction",anchorYUnits:"pixels",offsetOrigin:"top-left",size:[100,100],offset:[3,-32],scale:e.getView().getZoom()/30,opacity:.75})}),co=(e,t,n,o,s)=>{let i=360-o,l=Math.PI*(1/n-1/2);l+=i/180*Math.PI;let u,c,p,C=[];for(let h=0;h<n;++h){let k=h*((360-i)/360);u=l+k*2*Math.PI/n,c=e[0]+t*Math.cos(u),p=e[1]+t*Math.sin(u),C.push([c,p])}C.push(e);let v=new to(C);v.rotate(s/57.3,e);let D=v.getCoordinates();return new Le([D])},Ke=()=>{document.querySelectorAll(".flicker_point").forEach(t=>{t.classList.remove("flicker_point")})},io=e=>{e&&(e.getLayers().forEach(function(t){t.setMap(null)}),e.setView(null),e.setTarget(null),e=null)},uo=e=>new Gt({target:e,layers:Ae.layers,view:Ae.view,interactions:zt({mouseWheelZoom:!0})}),po=(e,t)=>{let n="";switch(t){case"empty":n="empty";break;case"t0vec":n="t0cva";break;case"t3img":n="t07cia";break;case"t4ter":n="t4cva";break}let o=We(pe.getBaseMapLayer(t)),s=ke(pe.getBaseMapTxt(n));o.values_.url,s.values_.url;const i=e.getLayers();e.getAllLayers().forEach((l,u)=>{if(l.get("type")==="baseLayer")switch(l.get("layerType")){case"baseMapLayer":e.removeLayer(l),i.insertAt(u,o);break;case"baseMapTxt":if(s!==""&&(e.removeLayer(l),i.insertAt(u,s)),s===""){let c=ke("");e.removeLayer(l),i.insertAt(u,c)}break}})},go=e=>{const t=e.getView().calculateExtent(e.getSize()),n=Yt(t),o=Jt(t),s=de(n,"EPSG:3857","EPSG:4326"),i=de(o,"EPSG:3857","EPSG:4326");return{topLeft:s,bottomRight:i}},yo=e=>{e.getControls().clear(),e.addControl(new Nt),e.addControl(new Ut),e.addControl(new Wt)},le=e=>{E.commonMenuMethodsArr.includes(e)||E.commonMenuMethodsArr.push(e)},Ye=e=>{let t=document.querySelector(".ol_map_wrap"),n=document.querySelector(".menu_wrap");n&&t.removeChild(n),e&&e(t)},mo=(e,t,n)=>{const{commonDynamicMenu:o,singleMenu:s}=E.menuMethodBtn;e.getViewport().addEventListener("contextmenu",i=>{var b;i.preventDefault(),n&&n(y=>{E.setMentBtnExtendByPage(y)});const l=e.getEventCoordinate(i),u=e.getPixelFromCoordinate(l),c=e.forEachFeatureAtPixel(u,y=>y);let p=[],C=[],v=[],D=[];De(e,y=>{let d=y.getSource().getFeatures()[0];d&&(p.push(d),d.get("tempType")==="myPointByMenu"&&C.push(d),d.get("businessType")==="POIMarker"&&v.push(d),d.get("drawType")&&D.push(d))}),N(p,o.commonDynamicMenuMethod1),N(c,o.commonDynamicMenuMethod2);const h=ge(e);N(h,o.commonDynamicMenuMethod3),N(C,"清空自定义标注点");let k=document.querySelectorAll(".flicker_point");N(k,"清空自定义闪烁点"),c&&(b=c.get("pointData"))!=null&&b.isNeedAnalysis&&N(c,o.commonDynamicMenuMethod4),N(D,o.commonDynamicMenuMethod5),N(v,s.singleMenuMethod2),Ye(y=>{let d=null;d=document.createElement("div"),d.setAttribute("class","menu_wrap");let f="";E.commonMenuMethodsArr.forEach(T=>{f+=`<li>${T}</li>`}),d.innerHTML=`
      <ul>
        ${f}
      </ul>
    `,d.style.position="fixed",d.style.left=`${i.clientX}px`,d.style.top=`${i.clientY}px`,y.appendChild(d),d.addEventListener("click",T=>{const B=T.target.textContent;t({option:B,feature:c,pixelPoint:l}),y.removeChild(d)})})})},ge=e=>e.getInteractions().getArray().find(t=>t instanceof ee),Te=e=>{const t=ge(e);e.removeInteraction(t)},te=e=>de(e,"EPSG:3857","EPSG:4326"),fo=(e,t)=>R([e,t]),Pe=e=>oo(no(e)),wo=e=>{const t=e.getGeometry();if(t.getType()==="Polygon"){const n=t.clone();n.transform("EPSG:3857","EPSG:4326");const o=n.getExtent();return Xt(o)}return null},vo=(e,t,n="/",o={},s=1)=>{const i=new A({features:[]}),l=new V({source:i,zIndex:s,style:n==="/"?Xe:He(e,n)});e.addLayer(l);const u=(c,p)=>({geometry:c,type:"Marker",pointData:p,...o});if(t instanceof Array)t.forEach(c=>{const p=new K(R(c.lonlat)),C=new O({...u(p,c.pointData)});i.addFeature(C)});else{const c=new K(R(t.lonlat)),p=new O({...u(c,t.pointData)});i.addFeature(p)}},ho=(e,t,n)=>{let o=new A;if(t instanceof Array)t.forEach(l=>{let u=R([l.longitude,l.latitude]),c=new O({geometry:new K(u),type:"Marker",pointData:l});o.addFeature(c)});else{let l=R([t.longitude,t.latitude]),u=new O({geometry:new K(l),type:"Marker",pointData:t});o.addFeature(u)}let s=new Ht({source:o,distance:50}),i=new V({type:"clusterLayer",source:s,style:function(l){l.set("type","Cluster");let u=l.get("features").length;return u===1?n==="/"?Xe:He(e,n):new z({image:new ye({radius:30,stroke:new W({color:"white"}),fill:new X({color:"blue"})}),text:new Re({text:u.toString(),fill:new X({color:"white"})})})}});e.addLayer(i)},Je=(e,t,n={},o)=>{const s=new O({geometry:new jt(t),type:"Line",...n});s.setStyle(o);const i=new A({features:[s]}),l=new V({source:i,zIndex:9});e.addLayer(l)},oe=(e,t,n=!1,o=2,s=5)=>new z(n?{image:new ye({radius:s,fill:new X({color:e}),stroke:new W({color:t,width:o})})}:{fill:new X({color:e}),stroke:new W({color:t,width:o})}),Qe=()=>oe("rgba(32, 157, 230, 0.2)","rgb(64 158 255)"),et=(e,t)=>{let n=null;switch(t.get("type")){case"Marker":n=oe("#409eff","#f00",!0,2,10);break;case"Curve":n=oe("#409eff","#f00",!1,5);break}t.setStyle(n),t.set("temp",!0);let o=new V({source:new A,zIndex:999});Z(e,s=>s.get("temp")),o.setOpacity(1),o.getSource().addFeature(t),e.addLayer(o)},tt=(e,t,n,o={},s)=>{const i=new z({text:new Re({text:t,fill:new X({color:"#333333"}),font:"18px pingfang",textAlign:"center",textBaseline:"bottom",padding:[5,10,5,10],offsetX:-20,offsetY:-13,overflow:!0,rotateWithView:!1,rotation:0})});s&&Z(e,c=>s(c));const l=new O({geometry:new K(R(n)),type:"textPoint",...o});l.setStyle(i);const u=new V({source:new A({features:[l]}),zIndex:9});e.addLayer(u)},ot=(e,t,n,o,s=null)=>{let i=document.getElementById("popup"),l=document.getElementById("popup-closer");i.style.display="block";let u=new Ze({element:i,...s,zIndex:9999});e.addOverlay(u),l.onclick=()=>(u.setPosition(void 0),l.blur(),u=null,!1),u.setPosition(t),u.getElement().onclick=c=>{o(c)}},Ee=(e,t,n)=>{let o=[];t.forEach(l=>{let u=oe("rgba(32, 222, 230, 0.4)","rgba(255, 205, 67, 0.3)"),c=100;if(n){let{myCurveStyle:D,myCurveRadius:h}=n(l);u=D,c=h}let p=R(l.lonlat),C=co(p,c,100,45,l.curveData.antDirectionAngle),v=new O(C);v.setStyle(u),v.set("type","Curve"),v.set("curveData",l.curveData),o.push(v)});let s=new A;s.addFeatures(o);let i=new V({source:s,zIndex:1});e.addLayer(i)},Fe=(e,t,n,o)=>{ot(e,t,n,o,{autoPan:!0})},ko=(e,t,n)=>{const s={name:"通用信息展示弹窗",hdms:Pe(e),coordinate:[t.longitude,t.latitude],popupData:t};n(s)},De=(e,t)=>{let n=e.getLayers().getArray();for(let o=n.length-1;o>=0;--o)n[o]instanceof V&&t(n[o])},Ce=e=>{Ke(),Te(e),De(e,t=>{e.removeLayer(t)})},Z=(e,t)=>{De(e,n=>{let o=n.getSource().getFeatures()[0];t(o)&&e.removeLayer(n)})},Po=(e,t)=>{Z(e,n=>{if(n)return n.get("type")===t})},nt=(e,t)=>{Z(e,n=>{if(n)return n.get("businessType")===t})},$e=e=>{Z(e,t=>{if(t)return(t.get("type")==="Marker"||t.get("type")==="Curve"||t.get("type")==="Cluster")&&!t.get("bussinessType")})},Co=e=>{Z(e,t=>{if(t)return t.get("tempType")}),Ke()},Lo=(e,t)=>{e.getView().animate({center:R(t),duration:800})},To=(e,t)=>{e.getLayers().forEach(n=>{let o=null;n&&(o=n.getSource()),o instanceof A&&o.forEachFeature(s=>{t(s)})})},Do=(e,t)=>{const o=new Kt({extractStyles:!1}).readFeatures(t);o.forEach(i=>{i.getGeometry().transform("EPSG:4326","EPSG:3857")});const s=new A({features:o});e.getView().fit(s.getExtent()),e.getLayers().push(new V({source:s,style:oe("blue","red"),zIndex:100}))},So=e=>{e.addInteraction(new ee({source:new A,type:"Polygon"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",n=>{const{feature:o}=n,s=o.getGeometry(),i=s.getCoordinates()[0],l=s.transform("EPSG:3857","EPSG:4326").getCoordinates()[0];s instanceof Le&&(rt(e,{coords:i,lonlat:l},{drawType:"polygon"}),e.removeInteraction(t))})})},rt=(e,{coords:t,lonlat:n,polygonData:o},s={},i,l=Qe())=>{let u=new O({geometry:new Le([t]),type:"Polygon",...s,polygonData:{coords:t,lonlat:n,...o}});u.setStyle(l);let c=new V({source:new A({features:[u]})});e.addLayer(c),i&&i(u)},_o=e=>{},bo=e=>{e.addInteraction(new ee({source:new A,type:"Circle"})),e.getInteractions().getArray().forEach(t=>{t instanceof ee&&t.on("drawend",n=>{const{feature:o}=n,s=o.getGeometry();let l={lonlat:de(s.getCenter(),"EPSG:3857","EPSG:4326"),radius:s.getRadius()};at(e,l,{drawType:"Circle"}),e.removeInteraction(t)})})},at=(e,t,n={},o,s=!1)=>{t.radius||(t.radius=550);let i=[],l=new O({type:"Circle",...n,circleData:t,geometry:new Zt(R(t.lonlat),t.radius)});l.setStyle(s?new z({fill:new X({color:"rgba(255, 0, 0, 0)"}),stroke:new W({color:"#f00",color:"rgba(255, 0, 0, 0)"})}):Qe()),i.push(l);let u=new A;u.addFeatures(i);let c=new V({zIndex:100});if(c.setSource(u),e.addLayer(c),o){let p=0;c.on("postrender",C=>{p>=20&&(p=0);var v=(20-p)*(1/20),D=new z({radius:p,stroke:new W({color:"rgba(255,60,5"+v+")",width:18-p/1.5})});let h=qt(C);h.setStyle(D),h.drawGeometry(l.getGeometry()),p=p+.2,e.render()})}},Mo=(e,t)=>{let n=new ee({source:new A,type:"LineString"});e.addInteraction(n),n.on("drawend",o=>{const{feature:s}=o,i=s.getGeometry();let l=Vt(i);l=l.toFixed(2);const u=i.getCoordinates(),c=i.transform("EPSG:3857","EPSG:4326").getCoordinates();t&&t(l),Je(e,u,{drawType:"TestDistance"}),tt(e,l+"米",c[0],{drawType:"TestDistance"})})},xo=e=>{Z(e,t=>{t.get("drawType")})},Bo=(e,t,n="../src/components/OpenlayerBaseMap/icon/routearrow.svg",o="arrowLine")=>{function s(i){const l=i.getGeometry(),u=l.getLength();let p=50*e.getView().getResolution(),C=Math.floor(u/p);const v=[new z({stroke:new W({color:"#42b983",width:6})})],D=[],h=[0];l.forEachSegment(function(k,b){let y=b[0]-k[0],d=b[1]-k[1],f=Math.atan2(d,y);h.unshift(Math.sqrt(y**2+d**2)+h[0]),D.push(f)});for(let k=1;k<C;k++){let b=l.getCoordinateAt(k*1/C);const y=k*p,d=h.findIndex(f=>f<=y);v.push(new z({geometry:new K(b),image:new qe({src:n,opacity:1,anchor:[.5,.5],rotateWithView:!0,rotation:-D[h.length-d-1],scale:.8})}))}return v}Je(e,t,{businessType:o},s)},Ao=(e,t)=>{const n=[],o=new O({geometry:new K(t),name:lo++,location:t,tempType:"myPointByMenu"}),s=new z({image:new ye({radius:15,fill:new X({color:"#409eff"}),stroke:new W({color:"#4440ff",width:1})})});o.setStyle(s),n.push(o);const i=new A({features:n}),l=new V({source:i,opacity:.8});e.addLayer(l)},st=(e,t,n="",o)=>{let s=document.createElement("div");s.className=`flicker_point ${n}`;let i=new Ze({element:s,position:t,zIndex:0});e.addOverlay(i),o&&s.addEventListener("click",()=>{o()})},Eo=(e,t,n)=>{te(n)},lt=()=>document.querySelector("#popup-content"),ie=(e,t)=>{w.emit("setCommonPopupInner",{popupObj:e,featureItem:t,callback:n=>{Oe(n,lt())}})},ue=(e,t)=>{let n=[];w.emit("setFeaturesPopupInner",{popupObj:e,callback:o=>{Oe(o,lt())},next:o=>{n=o}}),t&&t(n)},Fo={id:"popup",class:"ol-popup popup_toggle"},$o={__name:"PopupCommon",props:{currentPageType:{type:String,default:""}},setup(e,{expose:t}){let n=_(!1),o={},s=_(null);const i=e;w.on("showPopupDialog",y=>{u(y,i.currentPageType)}),w.on("getSingleByFeatures",({unique:y,itemData:d})=>{let f=y.split(":");const{arrData:T}=d;o.arrData=T,T.forEach(B=>{B[f[0]]===f[1]&&(o.currentPopupData=B,ie(o),l(o))})}),w.on("popupBack",()=>{o.popupData=o.arrData,o.noFeature=!0,ue(o)});const l=y=>{let d=document.getElementById("popup-content");ie(y);const f=document.createElement("b");f.setAttribute("data-function","popupBack"),f.setAttribute("id","popupBack"),f.setAttribute("title","返回"),f.innerHTML="",d.appendChild(f)},u=(y,d)=>{switch(d){case"demo":Ve(()=>{s.value.show(y)});break}},c=()=>{n.value=!0},p=()=>{n.value=!1},C=(y,d,f,T)=>{let B=document.querySelector("#popupBack");B&&T&&!T.get("businessType")&&B.remove();let j=te(d);const $={name:"通用信息展示弹窗",hdms:Pe(d),coordinate:j,popupData:f};o=$,w.emit("fixCommonPopupData",$),Fe(y,d,ie($,T),fe=>{D(fe)})},v=(y,d,f)=>{let T=te(d),B=Pe(d),j=[];f.forEach($=>{switch($.get("type")){case"Marker":j.push("标注点");break;case"Curve":j.push("扇区");break}});const ne={name:j.length+"个重叠要素",type:Array.from(new Set(j)).join(","),hdms:B,coordinate:T,popupData:f};o=ne,Fe(y,d,ue(ne,$=>{o.currentDataList=$}),$=>{D($)})},D=async y=>{const{target:d}=y;let f=d.getAttribute("data-function");f==="getMore"&&b(),f==="getSingleByFeatures"&&h(d.getAttribute("data-unique")),f==="popupBack"&&k()},h=y=>{if(!y)return;let d=y.split(":");const f=(T,B)=>{if(!T.get("noPopup")&&T.get(B)[d[0]]===d[1])return o.currentPopupData=T.get(B),T};o.currentPopupFeature=o.popupData.filter(T=>{switch(T.get("type")){case"Marker":return f(T,"pointData");case"Curve":return f(T,"curveData")}}),l(o,o.currentPopupFeature[0])},k=()=>{o.popupData instanceof Array&&ue(o)},b=()=>{w.emit("popupDataGetMore",{currentPopupObj:o,callback:y=>{u(y,i.currentPageType)}})};return t({showPopup:c,hidePopup:p,setCommonPopup:C,setFeaturesPopup:v}),(y,d)=>(U(),H(xt,null,[J(P("div",Fo,d[0]||(d[0]=[P("div",{class:"popup_wrap"},[P("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"}),P("div",{id:"popup-content",class:"popup-content"})],-1)]),512),[[Q,G(n)]]),F(ao,{ref_key:"refDemoPopupDetailDialog",ref:s},null,512)],64))}},Io=me($o,[["__scopeId","data-v-9b0f878b"]]),Oo={class:"lend_wrap"},Vo={class:"lent_tb_wrap"},Go=["title"],zo={__name:"Lend",props:{currentPageType:{type:String,default:""},isShowLend:{type:Boolean,default:!0}},setup(e){w.on("showLend",()=>{t.value=!0});let t=_(!1);const n=()=>{t.value=!t.value};return(o,s)=>J((U(),H("section",Oo,[J(P("div",Vo,[J(F(so,null,null,512),[[Q,e.currentPageType==="demo"]])],512),[[Q,G(t)]]),P("div",{class:"toggle",title:`点击${G(t)?"隐藏":"显示"}图例`,onClick:n},null,8,Go)],512)),[[Q,e.isShowLend]])}},Ro=me(zo,[["__scopeId","data-v-ce8fc5de"]]),Zo={class:"switch_base_layer_wrap"},qo={class:"switch_content"},jo=["title"],No={__name:"SwitchBaseLayer",emits:["switchBaseLayerType"],setup(e,{emit:t}){w.on("resetSwitchLayer",()=>{s.value.layerType="t3img"});const n=t;let o=_(!1);const s=_({layerType:"t3img"}),i=()=>{o.value=!o.value},l=u=>{n("switchBaseLayerType",u)};return(u,c)=>{const p=re("el-radio"),C=re("el-radio-group");return U(),H("section",Zo,[J(P("div",qo,[F(C,{modelValue:s.value.layerType,"onUpdate:modelValue":c[0]||(c[0]=v=>s.value.layerType=v),onChange:l},{default:q(()=>[F(p,{value:"t0vec"},{default:q(()=>c[1]||(c[1]=[ae("街道底图")])),_:1}),F(p,{value:"t3img"},{default:q(()=>c[2]||(c[2]=[ae("卫星(影像)底图")])),_:1}),F(p,{value:"t4ter"},{default:q(()=>c[3]||(c[3]=[ae("地形底图")])),_:1})]),_:1},8,["modelValue"])],512),[[Q,G(o)]]),P("div",{class:"toggle",title:`点击${G(o)?"隐藏":"显示"}`,onClick:i},null,8,jo)])}}},Uo=me(No,[["__scopeId","data-v-d79470cc"]]),Wo={class:"dialog_wrap"},Xo={key:0},Ho={__name:"SetTokenDialog",setup(e,{expose:t}){const{setMapToken:n}=ve();ve();let o=_("6b94eac741fe8a50f283b9b11d9d60d2");const s=_(null),i=_(""),l=_([]),u=(h,k)=>{const b=h?l.value.filter(c(h)):l.value;k(b)},c=h=>k=>k.value.toLowerCase().indexOf(h.toLowerCase())===0,p=()=>[{name:"token1",value:"02dd5ea16a6b869b3b37e12f269b1463"},{name:"token2",value:"53ce309465e600f242d351b15013397f"},{name:"token3",value:"37c72a79fe4c6a1b3fa6b1435214b378"},{name:"token4",value:"5a257cd2df1b3311723bd77b0de14baf"},{name:"token5",value:"7786923a385369346d56b966bb6ad62f"}],C=h=>{n(h.value)},v=()=>{if(i.value.length!==32){Ie.warning("请输入正确的token");return}w.emit("initOlMapByToken"),w.emit("resetSwitchLayer"),s.value.hide(),o.value=i.value};return Ge(()=>{l.value=p()}),t({show:h=>{s.value.show(),s.value.setDialogWidth("30%"),i.value=""}}),(h,k)=>{const b=re("el-autocomplete"),y=re("el-button"),d=re("dialog-info");return U(),Bt(d,{ref_key:"refDialogInfo",ref:s,class:"dialog_info_wrap",isShowFotter:!0},{DialogTitle:q(()=>k[1]||(k[1]=[P("span",null,"切换天地图token",-1)])),DialogContainer:q(()=>[P("div",Wo,[P("p",null,"当前token: "+se(G(o)),1),F(b,{modelValue:i.value,"onUpdate:modelValue":k[0]||(k[0]=f=>i.value=f),style:{width:"65%"},"fetch-suggestions":u,"popper-class":"my-autocomplete",placeholder:"请选择或者输入",onSelect:C,clearable:""},{suffix:q(()=>k[2]||(k[2]=[])),default:q(({item:f})=>[P("div",{class:At(["input_wrap",{current_selected:f.value===G(o)}])},[P("h3",null,[ae(se(f.name)+" ",1),f.value===G(o)?(U(),H("span",Xo,"- 当前token")):ze("",!0)]),P("span",null,se(f.value),1)],2)]),_:1},8,["modelValue"]),F(y,{type:"primary",style:{"margin-left":"25px"},onClick:v,disabled:i.value===""},{default:q(()=>k[3]||(k[3]=[ae(" 确定 ")])),_:1},8,["disabled"])])]),_:1},512)}}},Ko=me(Ho,[["__scopeId","data-v-069690c6"]]),Yo={key:0,class:"ol_map_wrap"},Jo=["title"],Qo={class:"copyright_info"},en={key:1},tn=Et({name:"gis"}),un=Object.assign(tn,{props:{currentPageType:{type:String,default:""},isAutoRenderData:{type:Boolean,default:!1},isShowLend:{type:Boolean,default:!0},isControlOverviewInfo:{type:Boolean,default:!1}},emits:["getOlMapInstance","getCurrentViewData","reflashMap","toggleOverviewInfo","getCircleData","setCircleDialogData"],setup(e,{expose:t,emit:n}){const o=n,s=e,{proxy:i}=Ft(),l=$t(),u="production";let c=null;const p=_(null),C=_(null),v=_(null);let D=_(!0);const h=_(0),k=_(""),b=_(!0);let y=_({});const d={minRenderZoom:we},f=()=>{D.value=!D.value,o("toggleOverviewInfo",D.value)},T=r=>{c=r,o("getOlMapInstance",r,d),yo(r),mo(r,a=>{B(a)},a=>{a(s.currentPageType)})},B=({option:r,feature:a,pixelPoint:m})=>{p.value.hidePopup(),E.setMenuMethods(c,r,a,m,i)},j=r=>{s.isAutoRenderData||o("getCurrentViewData",r),o("getCircleData",r)},ne=r=>{it(r)},$=r=>{po(c,r)},fe=(r,a,m,g=!0)=>{p.value.hidePopup(),b.value&&_e(c),setTimeout(()=>{g?a.forEach(L=>{m(r,L)}):m(r,a)},500)},ct=async(r,a,m,g)=>{const{arrData:L}=a;m&&m(a),p.value.hidePopup(),r.getView().setZoom(18),be(c,[a.longitude,a.latitude]),Ce(c),g&&g(r,[a]),setTimeout(()=>{To(r,x=>{let S={};switch(x.get("type")){case"Marker":S=x.get("pointData");break;case"Curve":S=x.get("curveData");break}S.cgi===a.cgi&&(y.value={featureData:S,featureItem:x})})},1e3);const M=Se(a.longitude,a.latitude);ko(M,a,x=>{if(L)x.popupData=L,x.noFeature=!0;else{let S=document.querySelector("#popupBack");S&&S.remove()}ot(r,M,L?ue(x):ie(x),S=>{const{target:Y}=S;Y.getAttribute("data-function")==="getMore"&&w.emit("popupDataGetMore",{currentPopupObj:a,callback:bt=>{w.emit("showPopupDialog",bt)}}),Y.getAttribute("data-function")==="getSingleByFeatures"&&w.emit("getSingleByFeatures",{unique:Y.getAttribute("data-unique").trim(),itemData:a}),Y.getAttribute("data-function")==="popupBack"&&w.emit("popupBack")})})};w.on("initOlMapByToken",()=>{Me()}),w.on("reflashMap",r=>{r&&c.getView().getZoom()>we&&w.emit("resetBtn"),Co(c),o("reflashMap",r,()=>{Ve(()=>{setTimeout(()=>{if(!It(y.value)){let{featureData:a,featureItem:m}=y.value;et(c,m)}},1e3)})})}),w.on("cancelDrawInteraction",()=>{Z(c,r=>r.get("drawType")),Te(c)}),w.on("drawPolygon",()=>{So(c)}),w.on("cancelPolygon",()=>{_o(c)}),w.on("drawCircle",()=>{bo(c)}),w.on("cancelCircle",()=>{}),w.on("testDistance",r=>{Mo(c,r)}),w.on("cancelTestDistance",()=>{xo(c)}),w.on("showSetTokenDialog",()=>{var r;(r=v.value)==null||r.show()}),w.on("singleFeaturesClick",({feature:r,pixelPoint:a})=>{if(s.currentPageType==="complain"){o("setCircleDialogData",r);return}ce(c,r,a)});const it=r=>{r.on("pointermove",a=>{let m=r.getEventPixel(a.originalEvent),g=r.hasFeatureAtPixel(m);r.getTargetElement().style.cursor=g?"pointer":"",k.value=te(a.coordinate)}),r.on("singleclick",a=>{if(ge(r))return;p.value.hidePopup(),Ye();let m=r.getEventPixel(a.originalEvent),g=r.getFeaturesAtPixel(m);const L=S=>g.filter(Y=>Y.get("type")===S),M=S=>JSON.stringify(L(S))!=="[]",x=()=>{let S=L("Marker")[0]||L("Curve")[0];g.length===2?S&&S.get("type")&&ce(c,S,a.coordinate):p.value.setFeaturesPopup(r,a.coordinate,g)};g&&(g.length===1&&(L("Circle").length!==0&&p.value.hidePopup(),ce(r,g[0],a.coordinate)),g.length>1&&(M("Cluster")&&(p.value.hidePopup(),ce(r,g[0],a.coordinate)),(M("Circle")||M("Polygon"))&&x(),M("Circle")||M("Polygon")||(g[0].get("type")==="Curve"||g[0].get("type")==="Marker")&&p.value.setFeaturesPopup(r,a.coordinate,g)))}),r.on("moveend",a=>{let m=c.getView(),g=m.getZoom();h.value=g.toFixed(2);let L=m.getCenter();w.emit("getCurrentCenter",te(L)),w.emit("getCurrentZoom",{zoom:g,minRenderZoom:we}),s.isAutoRenderData&&($e(r),o("getCurrentViewData",r))})},ce=(r,a,m)=>{if(a&&a.get("drawType")&&ge(r))return;let g=null;if(a&&a.get("type")==="Cluster"){p.value.hidePopup();let L=a.get("features");if(L.length===1){g=L[0].get("pointData"),p.value.setCommonPopup(r,m,g,L[0]);return}const M=ro(L.map(x=>x.getGeometry().getCoordinates()));r.getView().fit(M,{duration:1e3,padding:[50,50,50,50]})}a&&a.get("type")==="Marker"&&(g=a.get("pointData"),p.value.setCommonPopup(r,m,g,a)),a&&a.get("type")==="Curve"&&(g=a.get("curveData"),p.value.setCommonPopup(r,m,g)),a&&a.get("type")==="Circle"&&ut(a),a&&a.get("type")==="Polygon"&&(a.get("polygonData"),a.get("businessType"),dt(a))},ut=r=>{let a=r.get("circleData");w.emit("setCircleDialogData",a)},dt=r=>{const{coords:a,lonlat:m,name:g}=r.get("polygonData");w.emit("setPolygonDialogData",{lonlat:m,name:g})},pt=r=>go(r),Se=(r,a)=>fo(r,a),gt=(r,a,m={},g,L)=>{at(r,a,m,g,L)},yt=(r,a,m,g)=>{st(r,a,m,g)},mt=(r,a)=>{Do(r,a)},ft=r=>{Ce(r)},wt=(r,a)=>{Po(r,a)},vt=(r,a)=>{nt(r,a)},ht=(r,a,m,g={},L)=>{vo(r,a,m,g,L)},kt=(r,a,m)=>{ho(r,a,m)},_e=r=>{$e(r)},Pt=(r,a)=>oe(r,a),Ct=(r,a,m)=>{m?Ee(r,a,g=>m(g)):Ee(r,a)},be=(r,a)=>{Lo(r,a)},Lt=(r,{coords:a,lonlat:m,polygonData:g},L,M,x)=>{rt(r,{coords:a,lonlat:m,polygonData:g},L,M,x)},Tt=(r,a,m,g,L={},M)=>{tt(r,a,m,{businessType:g,...L},M)},Dt=r=>wo(r),St=(r,a,m,g)=>{Bo(r,a,m,g)},Me=()=>{{let a=setTimeout(()=>{l.push("/map/openlayer/openlayer-gd/empty"),clearTimeout(a)},5e3)}_t(c);const r=uo("olMap");T(r),j(r),ne(r)},_t=r=>{r&&io(r)};return Ge(()=>{Me()}),t({renderFeatureByData:fe,setMapByAutoPopupData:ct,getCurrentViewPosition:pt,transformToPixelPoint:Se,addCircle:gt,addFlickerPoint:yt,loadKML:mt,removeAllLayer:ft,removeLayerByType:wt,removeLayerByBusinessType:vt,addPoint:ht,setCluster:kt,removeAllDefaultLayer:_e,addCurve:Ct,createPolygon:Lt,flyToCoordinate:be,setFeaturesStyle:Pt,addTextPoint:Tt,getPolygonCenter:Dt,addArrowLine:St}),(r,a)=>G(u)==="development"?(U(),H("section",Yo,[Ot(r.$slots,"default"),a[3]||(a[3]=P("section",{id:"olMap",class:"ol_map"},null,-1)),F(Ro,{ref_key:"refLend",ref:C,currentPageType:e.currentPageType,isShowLend:e.isShowLend},null,8,["currentPageType","isShowLend"]),e.isControlOverviewInfo?(U(),H("div",{key:0,class:"overview_info_toggle",title:`点击${G(D)?"隐藏":"显示"}`,onClick:f},null,8,Jo)):ze("",!0),F(Uo,{onSwitchBaseLayerType:$}),F(Io,{ref_key:"refPopupCommon",ref:p,currentPageType:e.currentPageType},null,8,["currentPageType"]),J(P("div",Qo,[a[2]||(a[2]=P("p",null,"Copyright © CMDI.vip All Rights Reserved.",-1)),P("ul",null,[P("li",null,[P("dl",null,[a[0]||(a[0]=P("dt",null,"经纬度：",-1)),P("dd",null,se(k.value),1)])]),P("li",null,[P("dl",null,[a[1]||(a[1]=P("dt",null,"当前层级：",-1)),P("dd",null,se(h.value),1)])])])],512),[[Q,!0]]),F(Ko,{ref_key:"refSetTokenDialog",ref:v},null,512)])):(U(),H("section",en," 天地图服务暂不可用,即将跳转高德地图服务页面！ "))}});export{un as _};
